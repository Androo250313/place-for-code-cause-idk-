local v1000 = game:GetService("Players")
local v10000 = game:GetService("RunService")
local v100000 = game:GetService("UserInputService")
local v1000000 = v1000.LocalPlayer
local v100000000 = game:GetService("Workspace")

local smoothnessInput = 0
local maxDist = 50
local deadzone = 0

local charConnect
local charDisconnect


local function getTarget(root)
    if not root then 
        return nil
    end

    local closestTarget = nil
    local closestDist = maxDist

    local liveFolder = v100000000:FindFirstChild("Live")
    if liveFolder then
        for _, model in pairs(liveFolder:GetChildren()) do
            if model:IsA("Model") and model.Name == "Weakest Dummy" then
                local humanoid = model:FindFirstChildOfClass("Humanoid")
                local rootPart = model:FindFirstChild("HumanoidRootPart")
                if humanoid and humanoid.Health > 0 and rootPart then
                    local dist = (rootPart.Position - root.Position).Magnitude
                    if dist < closestDist then
                        closestDist = dist
                        closestTarget = model
                    end
                end
            end
        end
    end

    for _, player in ipairs(v1000:GetPlayers()) do
        if player ~= v1000000 and player.Character then
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            local rootPart = player.Character:FindFirstChild("HumanoidRootPart")
            if humanoid and humanoid.Health > 0 and rootPart then
                local dist = (rootPart.Position - root.Position).Magnitude
                if dist < closestDist then
                    closestDist = dist
                    closestTarget = player.Character
                end
            end
        end
    end

    return closestTarget
end


local function setupInput()
    inputBeganConn = v100000.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then 
            return 
        end
    end)
    inputEndedConn = v100000.InputEnded:Connect(function(input, gameProcessed)
        if gameProcessed then 
            return 
        end
    end)
end

local function setupAimbot()
    if charConnect then 
        charDisconnect:Disconnect() 
    end

    charConnect = v10000.Heartbeat:Connect(function(dt)
        local char = v1000000.Character

        if not char then 
            removeHighlight()
            return
        end

        local rootPart = char:FindFirstChild("HumanoidRootPart")
        local humanoid = char:FindFirstChildOfClass("Humanoid")

        if not rootPart or not humanoid then 
            removeHighlight()
            return
        end

        local targetModel = getTarget(rootPart)

        if targetModel and targetModel.Parent then
            local targetRoot = targetModel:FindFirstChild("HumanoidRootPart")
            if targetRoot then
                local myPos = rootPart.Position
                local targetPos = Vector3.new(targetRoot.Position.X, myPos.Y, targetRoot.Position.Z)
                local direction = (targetPos - myPos)

                if direction.Magnitude > deadzone then
                    local currentCFrame = rootPart.CFrame - rootPart.CFrame.Position
                    local targetCFrame = CFrame.new(Vector3.new(0, 0, 0), direction.Unit)
                    local alpha = math.clamp(1 - math.exp(-dt / smoothness), 0, 1)
                    local newCFrame = currentCFrame:Lerp(targetCFrame, alpha)

                    humanoid.AutoRotate = false
                    pcall(function()
                        rootPart.CFrame = CFrame.new(myPos) * newCFrame
                    end)

                    createHighlight(targetModel)
                else
                    humanoid.AutoRotate = true
                    removeHighlight()
                end
            else
                humanoid.AutoRotate = true
                removeHighlight()
            end
        else
            humanoid.AutoRotate = true
            removeHighlight()
        end
    end)
end

local function setup()
    setupInput()
    setupAimbot()
    v1000000.CharacterAdded:Connect(function()
        setupAimbot()
    end)
    game:BindToClose(function()
        if charConnect then 
            charDisconnect:Disconnect() 
        end
        if inputBeganConn then 
            inputBeganConn:Disconnect() 
        end
        if inputEndedConn then 
            inputEndedConn:Disconnect() 
        end
        removeHighlight()
    end)
end

local success, err = pcall(setup)
if not success then
    warn(err)
end


-------------------------------------------------- highligh ig


local highlight

local function createHighlight(model)
    if not model then 
        return 
    end
    if highlight then
        if highlight.Adornee == model then 
            return 
        end
        highlight:Destroy()
    end

    highlight = Instance.new("Highlight")
    highlight.Adornee = model
    highlight.DepthMode = Enum.HighlightDepthMode.Occluded
    highlight.FillColor = Color3.fromRGB(255, 120, 120)
    highlight.FillTransparency = 0.4
    highlight.OutlineColor = Color3.fromRGB(180, 60, 60)
    highlight.OutlineTransparency = 0.6
    highlight.Parent = v100000000
end

local function removeHighlight()
    if highlight then
        highlight:Destroy()
        highlight = nil
    end
end


------------------------- calc the smoothness 

local function calcSmooth(n)
    if not n or type(n) ~= "number" then 
        n = 0 
    end
    if n <= 0 then
        return 0.05
    end
    if n == 1 then
        return 0.08
    end
    local val = 0.08 + (n - 1) * 0.3
    if val > 100 then 
        val = 100 
    end
    return val
end

local smoothness = calcSmooth(smoothnessInput)

------------- the v thing aka toggle
local function setupInput()
    inputBeganConn = v100000.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then 
            return 
        end

        if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.V then
            aimbotEnabled = not aimbotEnabled 
            if aimbotEnabled then
                charConnect:Connect()
            else
                if charConnect then 
                    charDisconnect:Disconnect()  
                end
                removeHighlight()  
            end
        end
    end)
end
